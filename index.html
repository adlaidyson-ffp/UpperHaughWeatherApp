<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upper Haugh Weather</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <meta name="theme-color" content="#1e374d">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/adlaidyson-ffp/FFPMisc2/refs/heads/main/UHWeatherApp-SquareLogo.png">
  <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/adlaidyson-ffp/FFPMisc2/refs/heads/main/UHWeatherApp-SquareLogo.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="UH Weather">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root {
      --bg: #1e374d;
      --text: #94fdf8;
      --card: rgba(30, 55, 77, 0.6);
      --border: rgba(148, 253, 248, 0.3);
      --sec: rgba(148, 253, 248, 0.7);
    }
    body.amoled-mode {
      --bg: #000;
      --text: #fff;
      --card: rgba(18, 18, 18, 0.7);
      --border: rgba(255, 255, 255, 0.1);
      --sec: rgba(255, 255, 255, 0.8);
    }
    body {
      font-family: Inter, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      transition: background 0.5s ease, color 0.5s ease;
    }
    .weather-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 1.25rem;
      margin-bottom: 1rem; /* Spacing between cards */
    }
    .scrollable-x {
      overflow-x: auto;
      scrollbar-width: none;
    }
    .scrollable-x::-webkit-scrollbar {
      display: none;
    }
    .progress-bar-container {
      width: 100%;
      background: var(--sec);
      border-radius: 5px;
      height: 10px;
      margin-top: 0.5rem;
    }
    .progress-bar {
      height: 100%;
      width: 0;
      background: gray;
      border-radius: 5px;
      transition: width 0.5s, background 0.5s;
    }
    .loading-spinner {
      border: 4px solid rgba(148, 253, 248, 0.3);
      border-top: 4px solid var(--text);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .hourly-time {
      display: flex;
      flex-direction: row;
      gap: 4px;
      align-items: baseline;
      font-size: 0.875rem;
    }
    .hourly-time .time {
      font-weight: 600;
    }
    .hourly-time .ampm {
      font-size: 0.75rem;
      color: #94fdf8cc;
    }
    .bar {
      width: 3px;
      margin: 0 1px;
      background: #63b3ed;
      display: inline-block;
      border-radius: 2px;
    }
    section.text-center.mt-8.space-y-2 a {
      display: inline-block;
      background-color: #94fdf8;
      color: #1e374d;
      font-weight: 600;
      padding: 0.5rem 1rem;
      border-radius: 0.75rem;
      width: 220px; /* fixed width */
      text-align: center;
      font-size: 0.875rem;
      transition: background-color 0.3s ease;
    }
    section.text-center.mt-8.space-y-2 a:hover,
    section.text-center.mt-8.space-y-2 a:focus {
      background-color: #7ad9e3;
      outline: none;
    }
  </style>
</head>
<body>
  <div id="loading" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
    <div class="loading-spinner"></div>
  </div>
  <div id="error" class="hidden text-red-600 text-center p-4 font-bold">Unable to load weather.</div>
  <main id="weather-app" class="hidden p-4 w-full max-w-5xl mx-auto">
    <div class="text-center py-2 mb-4 border-b border-gray-500">
      <p id="current-date" class="text-lg font-semibold"></p>
    </div>

    <div class="flex justify-end mb-4">
      <button id="amoled-toggle" class="bg-gray-700 text-white px-3 py-1 rounded-full transition">
        <i id="theme-icon" class="fa-regular fa-moon"></i>
      </button>
    </div>

    <section class="text-center mb-4">
      <h1 id="location" class="text-4xl font-bold">Upper Haugh</h1>
      <p id="current-temp" class="text-6xl my-2">--°C</p>
      <p id="weather-description" class="text-2xl capitalize">...</p>
      <p id="feels-like" class="text-gray-300">Feels like: --°C</p>
    </section>

    <div class="flex flex-col md:flex-row md:gap-4 md:items-start">
      <div class="md:w-1/2 md:flex md:flex-col">
        <section class="weather-card">
          <h2 class="text-xl font-semibold flex items-center">
            <i class="fa-solid fa-hourglass-start mr-2"></i>Hourly Forecast
          </h2>
          <div id="hourly-forecast" class="flex scrollable-x space-x-2 py-2"></div>
        </section>

        <section class="weather-card">
          <h2 class="text-xl font-semibold flex items-center">
            <i class="fa-solid fa-calendar-days mr-2"></i>7‑Day Forecast
          </h2>
          <div class="flex justify-between text-sm text-gray-300 mb-2 px-3">
            <span class="w-2/5">Day</span>
            <span class="w-1/5 text-center">Low</span>
            <span class="w-1/5 text-center">High</span>
            <span class="w-1/5 text-right">Rain (Chance)</span>
          </div>
          <div id="daily-forecast" class="flex flex-col space-y-2"></div>
        </section>
      </div>

      <div class="md:w-1/2 md:flex md:flex-col">
        <section id="weather-alerts-section" class="weather-card hidden">
          <h2 class="text-xl font-semibold flex items-center mb-2">
            <i class="fa-solid fa-bell mr-2"></i>Weather Alerts
          </h2>
          <div id="weather-alerts-content"></div>
        </section>

        <section class="weather-card flex flex-row justify-between items-center">
            <h2 class="text-lg font-semibold flex items-center"><i class="fa-solid fa-cloud-rain mr-2"></i>Precipitation</h2>
            <div class="text-right">
                <p id="precip-now" class="text-lg font-medium">-- mm</p>
                <p id="precip-chance" class="text-sm text-gray-300">--%</p>
            </div>
        </section>
        
        <section class="weather-card flex flex-row justify-between items-center">
            <h2 class="text-lg font-semibold flex items-center"><i class="fa-solid fa-droplet mr-2"></i>Humidity</h2>
            <div class="text-right">
                <p id="humidity-value" class="text-lg font-medium">--%</p>
                <p id="humidity-status" class="text-sm text-gray-300">--</p>
            </div>
        </section>
          
        <section class="weather-card flex flex-row justify-between items-center">
           <h2 class="text-lg font-semibold flex items-center"><i class="fa-solid fa-wind mr-2"></i>Wind</h2>
           <div class="text-right">
              <p id="wind-speed" class="text-lg">-- mph</p>
              <p id="wind-direction" class="text-sm text-gray-300">--</p>
           </div>
        </section>

        <section class="weather-card">
          <h2 class="text-xl font-semibold flex items-center justify-center"><i class="fa-solid fa-smog mr-2"></i>Air Quality</h2>
          <div class="text-center">
            <p id="aq-status" class="text-lg font-medium">--</p>
            <p id="aq-value" class="text-sm text-gray-300">AQI: --</p>
          </div>
          <div class="progress-bar-container"><div id="aq-bar" class="progress-bar"></div></div>
        </section>

        <section class="weather-card">
          <h2 class="text-xl font-semibold flex items-center justify-center"><i class="fa-solid fa-sun mr-2"></i>UV Index</h2>
          <div class="text-center">
            <p id="uv-value" class="text-lg font-medium">--</p>
            <p id="uv-status" class="text-sm text-gray-300">--</p>
          </div>
          <div class="progress-bar-container"><div id="uv-bar" class="progress-bar"></div></div>
          <p id="uv-advice" class="text-xs text-gray-300 mt-2 text-center"></p>
        </section>
      </div>
    </div>

    <section id="precip-section" class="weather-card hidden">
      <h2 class="text-xl font-semibold flex items-center">
        <i class="fa-solid fa-cloud-showers-heavy mr-2"></i>Next Hour Precipitation
      </h2>
      <div id="precip-graph" class="w-full h-24 flex items-end justify-center"></div>
      <p id="precip-info" class="text-sm text-gray-300 mt-2 text-center"></p>
    </section>

    <section class="weather-card">
      <h2 class="text-xl font-semibold flex items-center"><i class="fa-solid fa-sun-plant-wilt mr-2"></i>Sun & Moon</h2>
      <div class="flex justify-around mb-4">
        <div>
          <h3 class="text-lg font-medium">Sunrise</h3>
          <p id="sunrise" class="text-gray-300">--</p>
        </div>
        <div>
          <h3 class="text-lg font-medium">Sunset</h3>
          <p id="sunset" class="text-gray-300">--</p>
        </div>
      </div>
      <hr class="border-gray-500 my-4" />
      <div class="flex justify-around mb-4">
        <div>
          <h3 class="text-lg font-medium">Moonrise</h3>
          <p id="moon-rise" class="text-gray-300">--</p>
        </div>
        <div>
          <h3 class="text-lg font-medium">Moonset</h3>
          <p id="moon-set" class="text-gray-300">--</p>
        </div>
      </div>
      <div class="text-center pt-2">
        <h3 class="text-lg font-medium">Moon Phase</h3>
        <p id="moon-phase" class="text-gray-300">--</p>
        <p id="moon-illum" class="text-gray-300">--%</p>
      </div>
    </section>

    <section class="mt-8 flex flex-col md:flex-row md:justify-center md:space-x-12 text-center">
        <div class="space-y-2 md:items-center flex flex-col">
          <a href="https://adlaidyson.co.uk/UHWAppDailyForecastSignup"
             class="w-full md:w-65 inline-block px-4 py-2 bg-[#94fdf8] text-[#1e374d] font-medium rounded-lg hover:opacity-80 transition">
            Sign up for Daily Forecast
          </a>
          <a href="https://adlaidyson.co.uk/UHWAppDailyForecastCancel"
             class="w-full md:w-65 inline-block px-4 py-2 bg-[#94fdf8] text-[#1e374d] font-medium rounded-lg hover:opacity-80 transition">
            Cancel Daily Forecast
          </a>
        </div>
        <div class="space-y-2 mt-4 md:mt-0 md:items-center flex flex-col">
          <a href="https://redirect.adlaidyson.co.uk/uhwapptools"
             class="w-full md:w-65 inline-block px-4 py-2 bg-[#94fdf8] text-[#1e374d] font-medium rounded-lg hover:opacity-80 transition">
            Learn more about this tool
          </a>
          <a href="https://redirect.adlaidyson.co.uk/uhwappgithub"
             class="w-full md:w-65 inline-flex items-center justify-center px-4 py-2 bg-[#94fdf8] text-[#1e374d] font-medium rounded-lg hover:opacity-80 transition">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#1e374d" class="w-5 h-5 mr-2">
              <path d="M12 .5C5.65.5.5 5.65.5 12c0 5.1 3.3 9.4 7.9 10.9.6.1.8-.2.8-.5v-1.8c-3.2.7-3.8-1.5-3.8-1.5-.5-1.2-1.2-1.5-1.2-1.5-1-.7.1-.7.1-.7 1.1.1 1.7 1.1 1.7 1.1 1 .1 1.7-.8 1.7-.8.3-1.1.8-1.4 1.2-1.6-2.6-.3-5.3-1.3-5.3-5.8 0-1.3.5-2.4 1.2-3.2-.1-.3-.5-1.5.1-3.1 0 0 1-.3 3.3 1.2 1-.3 2.1-.5 3.1-.5s2.1.2 3.1.5c2.3-1.5 3.3-1.2 3.3-1.2.6 1.6.2 2.8.1 3.1.8.8 1.2 1.9 1.2 3.2 0 4.5-2.7 5.5-5.3 5.8.4.3.8 1 .8 2v3c0 .3.2.6.8.5C20.7 21.4 24 17.1 24 12c0-6.35-5.15-11.5-12-11.5z"/>
            </svg>
          View on GitHub
        </a>
      </div>
    </section>

    <section class="text-center mt-6">
      <img src="https://raw.githubusercontent.com/adlaidyson-ffp/FFPMisc2/refs/heads/main/UHWAPPBannerLogo.png" alt="Upper Haugh Weather Logo" class="mx-auto max-w-xs w-full h-auto"/>
    </section>

    <footer class="text-center text-sm p-4">
        <p class="font-bold">Upper Haugh Weather</p>
        <p class="text-xs text-gray-300">
          Data from Open Weather Map (<a href="https://uhwappapi.adlaidyson.co.uk/weather" class="text-ceil" target="_blank">uhwappapi.adlaidyson.co.uk</a>)
        </p>
        <p class="mt-2"><a href="https://adlaidyson.co.uk" class="text-ceil" target="_blank">Made by Adlai Dyson | Fused Frame Photography</a></p>
    </footer>
  </main>
<script>
    // The JavaScript is the same as the last version and does not need changes for this layout fix.
    const toggle = document.getElementById('amoled-toggle'),
          icon = document.getElementById('theme-icon');

    function setTheme(val){
      document.body.classList.toggle('amoled-mode', val);
      icon.classList.toggle('fa-sun', val);
      icon.classList.toggle('fa-moon', !val);
      localStorage.setItem('amoled', val);
    }
    toggle.addEventListener('click', () => { setTheme(!document.body.classList.contains('amoled-mode')); });
    setTheme(localStorage.getItem('amoled') === 'true');

    function formatTime(ts) {
      const d = new Date(ts * 1000),
            h = ((d.getHours() + 11) % 12) + 1,
            m = d.getMinutes(),
            a = d.getHours() >= 12 ? 'PM' : 'AM';
      return { time: `${h}:${m.toString().padStart(2, '0')}`, ampm: a };
    }

    async function fetchWeather() {
      try {
        document.getElementById('loading').classList.remove('hidden');
        const res = await fetch('https://uhwappapi.adlaidyson.co.uk/weather');
        if(!res.ok) throw new Error("Failed to fetch weather data");
        const { weather, airPollution } = await res.json();
        const curr = weather.current;
        
        const today = new Date();
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('current-date').textContent = today.toLocaleDateString(undefined, options);

        document.getElementById('current-temp').textContent = Math.round(curr.temp) + '°C';
        document.getElementById('weather-description').textContent = curr.weather[0].description;
        document.getElementById('feels-like').textContent = 'Feels like: ' + Math.round(curr.feels_like) + '°C';
        
        const weatherAlertsSection = document.getElementById('weather-alerts-section');
        const weatherAlertsContent = document.getElementById('weather-alerts-content');
        weatherAlertsContent.innerHTML = ''; 

        if (weather.alerts && weather.alerts.length > 0) {
          weatherAlertsSection.classList.remove('hidden');
          const alert = weather.alerts[0];
          const level = alert.event.toLowerCase().includes('red') ? 'red' :
                        alert.event.toLowerCase().includes('amber') ? 'amber' : 'yellow';
          const alertBox = document.createElement('div');
          alertBox.className = `bg-${level === 'red' ? '[#ff4d4d]' : level === 'amber' ? '[#ffc107]' : '[#ffff66]'} text-[#1e374d] rounded-xl p-4`;
          alertBox.innerHTML = `
            <strong>${alert.event}</strong><br/>
            <p>${alert.description.split('.')[0]}.</p>
            <a href="https://www.metoffice.gov.uk/weather/warnings-and-advice/uk-warnings" class="underline font-semibold">More info</a>
          `;
          weatherAlertsContent.appendChild(alertBox);
        } else {
          weatherAlertsSection.classList.add('hidden');
        }
        
        const hr = document.getElementById('hourly-forecast');
        let hourlyHTML = '';
        weather.hourly.slice(0, 25).forEach((h, i) => {
          const timeObj = i === 0 ? {time: 'Now', ampm: ''} : formatTime(h.dt);
          const iconClass = h.weather[0].id < 600 ? 'fa-cloud-showers-heavy' :
                            h.weather[0].id < 700 ? 'fa-snowflake' :
                            h.weather[0].id === 800 ? 'fa-sun' : 'fa-cloud';
          hourlyHTML += `
            <div class="flex flex-col items-center min-w-[60px] p-2">
              <div class="hourly-time">
                <span class="time">${timeObj.time}</span>
                <span class="ampm">${timeObj.ampm}</span>
              </div>
              <span class="text-xl mt-1"><i class="fa-solid ${iconClass}"></i></span>
              <span class="font-medium mt-1">${Math.round(h.temp)}°C</span>
              ${h.pop > 0 ? `<span class="text-xs text-gray-300">${Math.round(h.pop * 100)}%</span>` : ''}
            </div>`;
        });
        hr.innerHTML = hourlyHTML;
        
        const ps = document.getElementById('precip-section');
        const totalPrecipNextHour = weather.hourly.slice(0, 12).reduce((sum, h) => sum + (h.rain?.['1h'] || h.snow?.['1h'] || 0), 0);

        if (totalPrecipNextHour > 0.1) { 
          ps.classList.remove('hidden');
          const maxPrecip = Math.max(...weather.hourly.slice(0, 12).map(h => h.rain?.['1h'] || h.snow?.['1h'] || 0));
          const bars = weather.hourly.slice(0, 12).map(h => {
            const val = (h.rain?.['1h'] || h.snow?.['1h'] || 0);
            const height = maxPrecip > 0 ? (val / maxPrecip) * 100 : 0; 
            return `<div class="bar" style="height:${height}%" title="${val.toFixed(1)}mm"></div>`;
          }).join('');
          document.getElementById('precip-graph').innerHTML = bars;

          const firstPrecipHour = weather.hourly.find(h => (h.rain?.['1h'] || h.snow?.['1h'] || 0) > 0);
          const precipType = firstPrecipHour.weather[0].main.toLowerCase();
          document.getElementById('precip-info').textContent = `Light ${precipType} starting in the next hour.`;
        } else {
          ps.classList.add('hidden');
        }
        
        const dl = document.getElementById('daily-forecast');
        let dailyHTML = '';
        weather.daily.slice(1, 8).forEach(d => {
          const dt = new Date(d.dt * 1000);
          const day = dt.toLocaleDateString(undefined, { weekday: 'long' });
          const dateNum = dt.getDate();
          const pop = Math.round(d.pop * 100);
          const rainAmount = Math.round(d.rain || 0);
          const icon = d.weather[0].id < 600 ? 'fa-cloud-showers-heavy' :
                       d.weather[0].id < 700 ? 'fa-snowflake' :
                       d.weather[0].id === 800 ? 'fa-sun' : 'fa-cloud';
          dailyHTML += `
            <div class="flex justify-between items-center px-3 py-2 rounded hover:bg-[#14304d] transition-colors">
              <div class="w-2/5 flex items-center gap-2">
                <i class="fa-solid ${icon}"></i>
                <span>${day} <span class="text-gray-400 text-sm">(${dateNum})</span></span>
              </div>
              <div class="w-1/5 text-center text-sm text-gray-300">${Math.round(d.temp.min)}°</div>
              <div class="w-1/5 text-center text-sm text-gray-300">${Math.round(d.temp.max)}°</div>
              <div class="w-1/5 text-right text-sm text-gray-300">
                ${rainAmount > 0 ? rainAmount + 'mm' : '--'} (${pop}%)
              </div>
            </div>`;
        });
        dl.innerHTML = dailyHTML;
        
        const currentRainAmount = (curr.rain?.['1h'] || curr.snow?.['1h'] || 0).toFixed(1);
        document.getElementById('precip-now').textContent = `${currentRainAmount} mm`;
        document.getElementById('precip-chance').textContent = `${Math.round(weather.hourly[0].pop * 100) || 0}%`;
        
        const humidity = curr.humidity;
        document.getElementById('humidity-value').textContent = `${humidity}%`;
        let humidityStatus = 'Comfortable';
        if (humidity < 30) {
            humidityStatus = 'Dry';
        } else if (humidity > 60) {
            humidityStatus = 'Muggy';
        }
        document.getElementById('humidity-status').textContent = humidityStatus;
        
        document.getElementById('wind-speed').textContent = Math.round(curr.wind_speed * 2.237) + ' mph';
        document.getElementById('wind-direction').textContent = `${windDegToCompass(curr.wind_deg)}`;

        if (airPollution && airPollution.list?.length > 0) {
          const aqi = airPollution.list[0].main.aqi;
          document.getElementById('aq-value').textContent = `AQI: ${aqi}`;
          const status = ['Good', 'Fair', 'Moderate', 'Poor', 'Very Poor'][aqi - 1] || '--';
          document.getElementById('aq-status').textContent = status;
          const bar = document.getElementById('aq-bar');
          bar.style.width = (aqi * 20) + '%';
          bar.style.backgroundColor = ['#4caf50', '#ffeb3b', '#ff9800', '#f44336', '#b71c1c'][aqi - 1] || 'gray';
        } else {
          document.getElementById('aq-status').textContent = '--';
          document.getElementById('aq-value').textContent = 'AQI: --';
          document.getElementById('aq-bar').style.width = '0';
        }
        
        const uv = curr.uvi;
        document.getElementById('uv-value').textContent = uv.toFixed(0);
        const uvStatus = uv < 3 ? 'Low' : uv < 6 ? 'Moderate' : uv < 8 ? 'High' : uv < 11 ? 'Very High' : 'Extreme';
        document.getElementById('uv-status').textContent = uvStatus;
        const uvBar = document.getElementById('uv-bar');
        uvBar.style.width = Math.min(100, uv * 10) + '%';
        uvBar.style.backgroundColor = uv < 3 ? '#4caf50' : uv < 6 ? '#ffeb3b' : uv < 8 ? '#ff9800' : uv < 11 ? '#f44336' : '#b71c1c';
        const uvAdvice = {
          'Low': 'No protection needed.',
          'Moderate': 'Seek shade during midday hours.',
          'High': 'Wear sunscreen and protective clothing.',
          'Very High': 'Reduce time in the sun between 10am-4pm.',
          'Extreme': 'Avoid the sun during midday hours.'
        };
        document.getElementById('uv-advice').textContent = uvAdvice[uvStatus] || '';
        
        document.getElementById('sunrise').textContent = formatDate(weather.current.sunrise);
        document.getElementById('sunset').textContent = formatDate(weather.current.sunset);
        document.getElementById('moon-rise').textContent = formatDate(weather.daily[0].moonrise);
        document.getElementById('moon-set').textContent = formatDate(weather.daily[0].moonset);
        document.getElementById('moon-phase').textContent = moonPhaseText(weather.daily[0].moon_phase);
        
        const moonPhaseValue = weather.daily[0]?.moon_phase;
        if (typeof moonPhaseValue === 'number') {
          const illumination = (moonPhaseValue <= 0.5 ? moonPhaseValue * 2 : (1 - moonPhaseValue) * 2);
          document.getElementById('moon-illum').textContent = `Illumination: ${(illumination * 100).toFixed(0)}%`;
        } else {
          document.getElementById('moon-illum').textContent = `Illumination: --%`;
        }

        document.getElementById('loading').classList.add('hidden');
        document.getElementById('weather-app').classList.remove('hidden');
        document.getElementById('error').classList.add('hidden');
      } catch(e) {
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('error').classList.remove('hidden');
        document.getElementById('weather-app').classList.add('hidden');
        console.error("Error fetching weather data:", e);
      }
    }
    function windDegToCompass(num) {
      const val = Math.floor((num / 22.5) + 0.5);
      const arr = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE',
                   'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];
      return arr[(val % 16)];
    }
    function formatDate(ts) {
      if (!ts) return '--';
      const d = new Date(ts * 1000);
      return d.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit', hour12: true });
    }
    function moonPhaseText(phase) {
      if (phase === undefined) return '--';
      if (phase === 0 || phase === 1) return 'New Moon';
      if (phase < 0.25) return 'Waxing Crescent';
      if (phase === 0.25) return 'First Quarter';
      if (phase < 0.5) return 'Waxing Gibbous';
      if (phase === 0.5) return 'Full Moon';
      if (phase < 0.75) return 'Waning Gibbous';
      if (phase === 0.75) return 'Last Quarter';
      if (phase < 1) return 'Waning Crescent';
      return '--';
    }

    window.onload = fetchWeather;
    
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("Service Worker Registered"));
    }
</script>
</body>
</html>